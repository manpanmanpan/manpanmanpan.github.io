---
layout:     post
title:      Hive
subtitle:   
date:       2019-4-21
author:     Cassie Pan
header-img: img/post-bg-rwd.jpg 
catalog: true
tags:
    -  
---


Notes for the diffference between SQL and Hive

- Mapreduce  -------SQL------> Hive
- Spark -------SQL-------> Spark SQL

### 1. Create Table  &  Load

```
CREATE TABLE order (id INT, name STRING, capacity STRING, price DOUBLE)
    COMMENT 'This is the order table'
    ROW FORMAT DELIMITED
        FIELDS TERMINATED BY '\t'
STORES AS SEQUENCEFILE;

Load data local inpath 'home/hadoop/xxx.txt' into table order;
```

### 2. External tabel (connect to external data) VS Managed table (connect to local data)

```
CREATE EXTERNAL TABLE order_external (id INT, name STRING, capacity STRING, price DOUBLE)
    ROW FORMAT DELIMITED
    FIELDS TERMINATED BY '\t'
    LOCATION '/external/hive_ext';

```

Note: 
For internal (Managed) table, drop table order, we will drop all data and file;
for external table, drop table order_external, we will just drop data, the file is still in the hadoop dictionary path.

### 3. CTAS (Create a new temporary table)

```
CREATE TABLE Order_new
AS
SELECT id, name, price from order;
```

### 4. Insert (insert data to a exsiting temporary table)

- Hive doesn't support insert a row data, but can import a dataset.

```
Insert overwrite table order_new2
    SELECT * FROM order;
```

### 5. Partition

```
CREATE TABLE order_pati (id INT, name STRING, capacity STRING, price DOUBLE)
    PARTITIONED BY (month STRING)
    ROW FORMAT DELIMITED
    FIELDS TERMINATED BY '\t';
    
```

```
Load data local inpath '/home/hadoop/xxx.data' into table order_pati partition ( month = '201901');
Load data local inpath '/home/hadoop/yyy.data' into table order_pati partition ( month = '201902');

```

That code will create a new file named 'month = 201901' under order_pati file, which has xxx.data.

Then:

```
SELECT COUNT(*) FROM order_pati WHERE MONTH = '201901';
SELECT * FROM order_pati WHERE MONTH = '201901';
```